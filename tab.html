<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI-Powered Image Analyis</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>AI-Powered Image Analysis</h1>

    <div class="accordion mb-4" id="guideAccordion">
      <div class="accordion-item">
        <h2 class="accordion-header" id="guideAccordionHeading">
          <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#guideAccordionCollapse" aria-expanded="true" aria-controls="guideAccordionCollapse">
            <i class="fa-solid fa-lightbulb text-warning me-3 mt-1"></i>
            User Guide
          </button>
        </h2>
        <div id="guideAccordionCollapse" class="accordion-collapse collapse show" aria-labelledby="guideAccordionHeading" data-bs-parent="#guideAccordion">
          <div class="accordion-body">
            <div class="card p-3 mb-0 shadow-sm" style="background: #ffffff;">
              <div class="d-flex justify-content-between align-items-center gap-4 flex-wrap">
                <!-- Step 1: Upload & Describe -->
                <div class="flex-fill text-center" style="width: 160px;">
                  <div class="mb-2">
                    <i class="fa-solid fa-upload fa-2x text-success"></i>
                  </div>
                  <div class="fw-bold">1. Upload & Describe</div>
                  <div class="small text-muted mt-1">Upload a diagram and add or generate a description.</div>
                </div>
                <i class="fa-solid fa-arrow-right fa-lg text-secondary"></i>
                <!-- Step 2: Select Sources -->
                <div class="flex-fill text-center" style="width: 160px;">
                  <div class="mb-2">
                    <i class="fa-solid fa-globe fa-2x text-info"></i>
                  </div>
                  <div class="fw-bold">2. Select Sources</div>
                  <div class="small text-muted mt-1">Enter website URLs or patent numbers to search.</div>
                </div>
                <i class="fa-solid fa-arrow-right fa-lg text-secondary"></i>
                <!-- Step 3: Analyze -->
                <div class="flex-fill text-center" style="width: 160px;">
                  <div class="mb-2">
                    <i class="fa-solid fa-magnifying-glass-chart fa-2x text-warning"></i>
                  </div>
                  <div class="fw-bold">3. Analyze</div>
                  <div class="small text-muted mt-1">Click <b>Analyze</b> to start the search and view results.</div>
                </div>                
              </div>
                <div class="my-2 text-start">
                
                </div>
              <div class="mt-3" style="text-align: left;">
                <span style="font-size: 1.00em; color: #000000; font-weight: bold;">Use case examples:</span>
                <div class="d-flex flex-wrap gap-2 mt-2 use-case-btn-row">
                  <button class="btn btn-analyze py-1 px-2"
                    style="font-size: 0.9em; font-weight: bold; line-height: 1.2; width: auto; display: inline-block; background-color: #d798f5;">
                    Find similar circuit diagrams
                  </button>
                  <button class="btn btn-analyze py-1 px-2"
                    style="font-size: 0.9em; font-weight: bold; line-height: 1.2; width: auto; display: inline-block; background-color: #d798f5;">
                    Digital workflow analysis
                  </button>
                  <button class="btn btn-analyze py-1 px-2"
                    style="font-size: 0.9em; font-weight: bold; line-height: 1.2; width: auto; display: inline-block; background-color: #d798f5;">
                    Waveform anomaly detection
                  </button>
                  <button class="btn btn-analyze py-1 px-2"
                    style="font-size: 0.9em; font-weight: bold; line-height: 1.2; width: auto; display: inline-block; background-color: #d798f5;">
                    Golden sample benchmarking with image-based QA
                  </button>
                  <button class="btn btn-analyze py-1 px-2"
                    style="font-size: 0.9em; font-weight: bold; line-height: 1.2; width: auto; display: inline-block; background-color: #d798f5;">
                    Visual setup verification for compliance success
                  </button>
                  <button class="btn btn-analyze py-1 px-2"
                    style="font-size: 0.9em; font-weight: bold; line-height: 1.2; width: auto; display: inline-block; background-color: #d798f5;">
                    Image-based failure analysis
                  </button>
                  <button class="btn btn-analyze py-1 px-2"
                    style="font-size: 0.9em; font-weight: bold; line-height: 1.2; width: auto; display: inline-block; background-color: #d798f5;">
                    PCB layout consistency assurance with image search
                  </button>
                  <button class="btn btn-analyze py-1 px-2"
                    style="font-size: 0.9em; font-weight: bold; line-height: 1.2; width: auto; display: inline-block; background-color: #d798f5;">
                    Smart setup verification for 5G & advanced RF testing
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- First accordion: What to Search -->
    <div class="accordion mb-4" id="searchAccordionWhat">
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingInput">
          <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInput" aria-expanded="true" aria-controls="collapseInput">
            <span style="display: flex; align-items: center;">
              <i class="fa-solid fa-upload text-success me-2"></i>
              <span>Upload & Describe</span>
            </span>
          </button>
        </h2>
        <div id="collapseInput" class="accordion-collapse collapse show" aria-labelledby="headingInput">
          <div class="accordion-body">
            <div class="row">
              <!-- Image Search -->
              <div class="col-md-12">
                <div class="feature-card">
                  <h3>
                    <span style="display: flex; align-items: center;">
                      <i class="fa-solid fa-image me-2"></i>
                      <span>Image</span>
                    </span>
                    <span class="inline-info-icon">
                      <i class="fa-solid fa-circle-info"></i>
                      <span class="inline-info-tooltip">Upload an image. AI will generate the uploaded image.</span>
                    </span>
                  </h3>
                  <input id="user-image-input" class="form-control mb-2" type="file" accept="image/*">
                  <div id="user-image-preview" class="mt-2"></div>
                  <label for="user-image-description" class="form-label d-flex align-items-center gap-2" style="font-size: 0.9em; font-weight: bold;">
                    <span>AI-generated image description</span>
                    <!-- <button id="generate-description-button"
                            class="btn btn-analyze py-1 px-2"
                            style="font-size: 0.9em; font-weight: bold; line-height: 1.2;">
                      <i class="fa-solid fa-wand-magic-sparkles me-1"></i> Use AI to describe the uploaded image
                    </button> -->
                    <small id="generation-status" class="text-muted ms-3"></small>
                  </label>
                  <textarea id="user-image-description" class="form-control" rows="4"
                    placeholder="e.g., Satellite dish and antenna"
                    data-bs-toggle="tooltip" data-bs-placement="bottom"
                    title="Click to edit the description."></textarea>           
                  
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Second accordion: Where to Search -->
    <div class="accordion mb-4" id="searchAccordionWhere">
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingOther">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOther" aria-expanded="false" aria-controls="collapseOther">
            <span style="display: flex; align-items: center; gap: 0.5em;">
              <i class="fa-solid fa-globe fa-2 text-info"></i>
              <span>Select Sources</span>
            </span>
          </button>
        </h2>
        <div id="collapseOther" class="accordion-collapse collapse" aria-labelledby="headingOther">
          <div class="accordion-body">
            <div class="row g-4 align-items-center justify-content-center">
              <div class="col-md-5">
                <div class="feature-card h-100">
                  <h3>
                    <span style="display: flex; align-items: center;">
                      <i class="fa-solid fa-link me-2"></i>
                      <span>Search from Websites</span>
                    </span>
                    <span class="inline-info-icon">
                      <i class="fa-solid fa-circle-info"></i>
                      <span class="inline-info-tooltip">Paste one or more URLs to analyze their content.</span>
                    </span>
                  </h3>
                  <textarea id="url-input" class="form-control" rows="2" placeholder="e.g., https://example.com/article1, https://example.com/article2"></textarea>
                </div>
              </div>
              <div class="col-md-1 text-center">
                <span style="font-weight: bold; color: #888; font-size: 1.1em;">OR</span>
              </div>
              <div class="col-md-5">
                <div class="feature-card h-100">
                  <h3>
                    <span style="display: flex; align-items: center;">
                      <i class="fa-solid fa-hashtag me-2"></i>
                      <span>Search within Patents</span>
                    </span>
                    <span class="inline-info-icon">
                      <i class="fa-solid fa-circle-info"></i>
                      <span class="inline-info-tooltip">Paste one or more patent numbers, separated by commas.</span>
                    </span>
                  </h3>
                  <textarea id="patent-numbers-input" class="form-control" rows="2" placeholder="e.g., US7012495B2, US11144829B2"></textarea>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- NEW: Third accordion for History -->
    <div class="accordion mb-4" id="historyAccordion">
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingHistory">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHistory" aria-expanded="false" aria-controls="collapseHistory">
                    <span style="display: flex; align-items: center; gap: 0.5em;">
                        <i class="fa-solid fa-clock-rotate-left"></i>
                        <span>History</span>
                    </span>
                </button>
            </h2>
            <div id="collapseHistory" class="accordion-collapse collapse" aria-labelledby="headingHistory">
                <div class="accordion-body">
                    <div id="history-container">
                        <!-- History cards will be dynamically injected here -->
                    </div>
                    <div id="history-actions" class="text-end mt-3 hidden">
                        <button id="clear-history-button" class="btn btn-sm btn-outline-danger">Clear All History</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="status-card" class="card mt-4 p-3 hidden">
      <h5 id="global-status">Starting...</h5>
      <p id="status" class="mb-1"></p>
      <p id="timing-info" class="text-muted small mb-0"></p>
    </div>

    <!-- CTA -->
    <div class="action-row">
      <button id="fetch-button" class="btn-analyze">Analyze <i class="fa fa-rocket ms-2"></i></button>
      <button id="stop-button" class="btn-analyze hidden" style="background-color: #dc3545; border-color: #dc3545;">Stop <i class="fa fa-stop ms-2"></i></button>
    </div>
  </div>
    <!-- Place the modal placeholder here -->
  <div id="use-case-modal-placeholder"></div>
  <!-- Result Containers -->
  <div id="image-analysis-container" class="hidden mt-4 px-3 px-md-4">
    <h5 style="display: inline-block;">
      Image Similarity Results
    </h5>
    <div class="info-box my-2">
      <i class="fa-solid fa-circle-info text-primary me-2"></i>
      <strong>Left click</strong> image to enlarge; <strong>Right click</strong> the enlarged image to rotate 90° clockwise
    </div>
    <!-- THIS CONTAINER FOR THE OLD ACCORDION VIEW IS NOW HIDDEN -->
    <div class="accordion hidden" id="image-vs-images-patents-container"></div>
  </div>

</div>

<!-- Place this near the end of your <body> -->
<div class="modal fade" id="enlargeImageModal" tabindex="-1" aria-labelledby="enlargeImageModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-body p-0 text-center">
        <img id="enlargeImageModalImg" src="" alt="Enlarged" style="width:100%;height:auto;object-fit:contain;">
      </div>
    </div>
  </div>
</div>

<script type="module" src="tab.js"></script>
<script src="scripts/bootstrap5.3.3.js"></script>
</body>
</html>